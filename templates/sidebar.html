{% load static %}
<aside class="sidebar" id="sidebar">
    <!-- New Add Button (ChatGPT style) -->
    <div class="sidebar-top">
        <a href="{% url 'home' %}" class="new-chat-btn">
           <b> <span class="medical-plus-icon">+ </span>
            AI Medical Reports </b>
        </a>
        <button class="close-sidebar-btn" id="sidebarCloseBtn" title="Close sidebar">
            <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line></svg>
        </button>
    </div>

    <!-- History Section -->
    <div class="sidebar-content">
        <a href="#" class="history-item {% if request.resolver_match.url_name == 'open_history_file' %}active{% endif %}">
            <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            History
        </a>

        <!-- Recent history items (chat-like) -->
        <div class="history-list" style="margin-top:1rem;">
            {% if sidebar_history_files %}
                {% for f in sidebar_history_files %}
                <a href="{% url 'open_history_file' f.name %}" class="history-item small-item" style="display:block; padding:0.6rem 0; text-overflow:ellipsis; white-space:nowrap; overflow:hidden;">
                    <span style="display:inline-block; width:36px; height:36px; border-radius:6px; background:rgba(0,0,0,0.04); text-align:center; line-height:36px; margin-right:8px; vertical-align:middle;">ðŸ“„</span>
                    <span style="vertical-align:middle; font-size:0.95rem; color:var(--text);">{{ f.name }}</span>
                </a>
                {% endfor %}
            {% else %}
                <div style="color:var(--text-muted); font-size:0.9rem; padding:0.5rem 0;">No history yet</div>
            {% endif %}
        </div>
    </div>
</aside>

<!-- Open Sidebar Button (visible when sidebar is closed) -->
<button class="open-sidebar-btn" id="headerOpenSidebarBtn" title="Open sidebar">
    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="9" y1="3" x2="9" y2="21"></line></svg>
</button>

<!-- Mobile Toggle -->
<button class="sidebar-mobile-toggle" id="sidebarToggle" title="Toggle sidebar">
    <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
</button>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const sidebar = document.getElementById('sidebar');
        const closeBtn = document.getElementById('sidebarCloseBtn');
        const openBtn = document.getElementById('headerOpenSidebarBtn'); // Will be in base.html
        const mobileToggleBtn = document.getElementById('sidebarToggle');
        
        // Function to close sidebar
        function closeSidebar() {
            sidebar.classList.add('closed');
            if(openBtn) openBtn.classList.add('visible');
        }

        // Function to open sidebar
        function openSidebar() {
            sidebar.classList.remove('closed');
            if(openBtn) openBtn.classList.remove('visible');
        }
        
        // Event Listeners
        if(closeBtn) {
            closeBtn.addEventListener('click', closeSidebar);
        }

        if(openBtn) {
            openBtn.addEventListener('click', openSidebar);
        }

        // Mobile toggle
        if(mobileToggleBtn){
            mobileToggleBtn.addEventListener('click', () => {
                sidebar.classList.toggle('open');
            });
        }
    });
</script>